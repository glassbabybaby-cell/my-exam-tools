<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èƒºåŸºé…¸åœ°ç„é»˜å¯«ç‰¹è¨“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=JetBrains+Mono:wght@500&display=swap');
        
        body { font-family: 'Noto Sans TC', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }

        .input-box {
            border: 2px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s;
            width: 100%;
        }
        .input-box:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .input-box.correct {
            border-color: #22c55e;
            background-color: #f0fdf4;
            color: #15803d;
        }
        .input-box.incorrect {
            border-color: #ef4444;
            background-color: #fef2f2;
            color: #991b1b;
        }

        .anim-shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

    <div class="max-w-3xl mx-auto w-full p-4 flex-grow flex flex-col">
        
        <!-- Header -->
        <header class="mb-6 text-center">
            <h1 class="text-2xl font-black text-slate-800 mb-2">ğŸ©¸ èƒºåŸºé…¸åœ°ç„é»˜å¯«</h1>
            <p class="text-sm text-slate-500">ä¸çµ¦é¸é …ï¼Œè«‹ç›´æ¥é»˜å¯«å‡ºå®Œæ•´çš„ä¸­è‹±æ–‡èˆ‡ç¸®å¯«</p>
        </header>

        <!-- Quiz Area -->
        <div id="quiz-area" class="bg-white rounded-2xl shadow-xl border border-gray-200 overflow-hidden flex-grow flex flex-col">
            
            <!-- Question Header -->
            <div class="bg-slate-800 p-6 text-white text-center relative">
                <span class="text-xs font-bold bg-blue-500 px-2 py-1 rounded text-white mb-2 inline-block" id="q-progress">Q1</span>
                <h2 class="text-2xl font-bold leading-relaxed" id="q-title">é¡Œç›®è¼‰å…¥ä¸­...</h2>
                <p class="text-slate-400 text-sm mt-2" id="q-hint"></p>
            </div>

            <!-- Input Area -->
            <div class="p-6 space-y-4 flex-grow" id="inputs-container">
                <!-- Rows will be injected here -->
            </div>

            <!-- Feedback Area (Hidden by default) -->
            <div id="feedback-area" class="bg-gray-50 p-6 border-t border-gray-200 hidden">
                <h3 class="font-bold text-gray-700 mb-3">æ­£ç¢ºç­”æ¡ˆå°ç…§ï¼š</h3>
                <div id="correct-answers-list" class="space-y-2 text-sm"></div>
            </div>

            <!-- Controls -->
            <div class="p-6 border-t border-gray-100 bg-gray-50 flex justify-between items-center">
                <div class="text-sm font-bold text-slate-400" id="status-text">è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½</div>
                <button onclick="checkAnswers()" id="action-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transform transition active:scale-95 text-lg">
                    äº¤å·æª¢æŸ¥
                </button>
            </div>
        </div>

    </div>

    <script>
        // è³‡æ–™åº«ï¼šä¾ç…§ä½ çš„ç­†è¨˜åˆ†é¡
        const categories = [
            {
                name: "å«ç¡«èƒºåŸºé…¸ (Sulfur)",
                hint: "å«æœ‰ç¡«åŸå­ï¼Œå…± 2 å€‹",
                items: [
                    { ch: "åŠèƒ±èƒºé…¸", en: "Cysteine", abbr: "Cys" },
                    { ch: "ç”²ç¡«èƒºé…¸", en: "Methionine", abbr: "Met" }
                ]
            },
            {
                name: "é…¸åŸºèƒºåŸºé…¸ (Acidic)",
                hint: "å´éˆå¸¶æœ‰ç¾§åŸºï¼Œå…± 2 å€‹",
                items: [
                    { ch: "å¤©é–€å†¬èƒºé…¸", en: "Aspartic acid", abbr: "Asp" },
                    { ch: "éº©èƒºé…¸", en: "Glutamic acid", abbr: "Glu" }
                ]
            },
            {
                name: "é¹¼æ€§èƒºåŸºé…¸ (Basic)",
                hint: "å´éˆå¸¶æœ‰å«æ°®å®˜èƒ½åŸºï¼Œå…± 3 å€‹",
                items: [
                    { ch: "é›¢èƒºé…¸", en: "Lysine", abbr: "Lys" },
                    { ch: "ç²¾èƒºé…¸", en: "Arginine", abbr: "Arg" },
                    { ch: "çµ„ç¹”èƒºé…¸", en: "Histidine", abbr: "His" }
                ]
            },
            {
                name: "èŠ³é¦™æ—èƒºåŸºé…¸ (Aromatic)",
                hint: "å«æœ‰è‹¯ç’°æˆ–å²å“šç’°ï¼Œå…± 3 å€‹",
                items: [
                    { ch: "è‹¯ä¸™èƒºé…¸", en: "Phenylalanine", abbr: "Phe" },
                    { ch: "é…ªèƒºé…¸", en: "Tyrosine", abbr: "Tyr" },
                    { ch: "è‰²èƒºé…¸", en: "Tryptophan", abbr: "Trp" }
                ]
            },
            {
                name: "ç¾¥åŸºèƒºåŸºé…¸ (Hydroxyl)",
                hint: "å´éˆå¸¶æœ‰ -OH åŸº (è„‚è‚ªæ—+èŠ³é¦™æ—)ï¼Œå…± 3 å€‹",
                items: [
                    { ch: "çµ²èƒºé…¸", en: "Serine", abbr: "Ser" },
                    { ch: "é…¥èƒºé…¸", en: "Threonine", abbr: "Thr" },
                    { ch: "é…ªèƒºé…¸", en: "Tyrosine", abbr: "Tyr" }
                ]
            },
            {
                name: "é†¯èƒºåŸºèƒºåŸºé…¸ (Amide)",
                hint: "é…¸æ€§èƒºåŸºé…¸çš„è¡ç”Ÿç‰©ï¼Œå…± 2 å€‹",
                items: [
                    { ch: "å¤©é–€å†¬ç´ ", en: "Asparagine", abbr: "Asn" },
                    { ch: "éº©èƒº", en: "Glutamine", abbr: "Gln" }
                ]
            },
            {
                name: "æ”¯éˆèƒºåŸºé…¸ (BCAA)",
                hint: "ç–æ°´æ€§åˆ†æ”¯å´éˆï¼Œå…± 3 å€‹",
                items: [
                    { ch: "ç™½èƒºé…¸", en: "Leucine", abbr: "Leu" },
                    { ch: "ç•°ç™½èƒºé…¸", en: "Isoleucine", abbr: "Ile" },
                    { ch: "çºˆèƒºé…¸", en: "Valine", abbr: "Val" }
                ]
            },
            {
                name: "äºèƒºåŸºé…¸ (Imino / Cyclic)",
                hint: "å”¯ä¸€çš„ç’°ç‹€éèŠ³é¦™æ—ï¼Œå…± 1 å€‹",
                items: [
                    { ch: "è„¯èƒºé…¸", en: "Proline", abbr: "Pro" }
                ]
            }
        ];

        let currentCategory = null;
        let isReviewing = false;
        let usedCategories = [];

        function initGame() {
            nextQuestion();
        }

        function nextQuestion() {
            // Pick a random category not recently used if possible
            let available = categories.filter(c => !usedCategories.includes(c));
            if (available.length === 0) {
                usedCategories = [];
                available = categories;
            }
            const randIndex = Math.floor(Math.random() * available.length);
            currentCategory = available[randIndex];
            usedCategories.push(currentCategory);

            // UI Reset
            document.getElementById('q-title').innerText = `è«‹å¯«å‡ºï¼š${currentCategory.name}`;
            document.getElementById('q-hint').innerText = currentCategory.hint;
            document.getElementById('feedback-area').classList.add('hidden');
            document.getElementById('action-btn').innerText = "äº¤å·æª¢æŸ¥";
            document.getElementById('action-btn').onclick = checkAnswers;
            document.getElementById('action-btn').className = "bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transform transition active:scale-95 text-lg";
            isReviewing = false;

            // Generate Inputs
            const container = document.getElementById('inputs-container');
            container.innerHTML = '';

            // We shuffle the items so user doesn't just memorize order, 
            // BUT for checking, we need to match user input to ANY correct item.
            // To make UI simple, we just generate N rows.
            
            for (let i = 0; i < currentCategory.items.length; i++) {
                const row = document.createElement('div');
                row.className = "grid grid-cols-1 md:grid-cols-12 gap-2 p-3 bg-gray-50 rounded-lg border border-dashed border-gray-300";
                row.innerHTML = `
                    <div class="md:col-span-1 flex items-center justify-center font-bold text-gray-400">#${i+1}</div>
                    <div class="md:col-span-3">
                        <input type="text" class="input-box" placeholder="ä¸­æ–‡åç¨±" data-type="ch">
                    </div>
                    <div class="md:col-span-5">
                        <input type="text" class="input-box mono" placeholder="è‹±æ–‡å…¨å (English)" data-type="en">
                    </div>
                    <div class="md:col-span-3">
                        <input type="text" class="input-box mono" placeholder="ç¸®å¯«" data-type="abbr">
                    </div>
                `;
                container.appendChild(row);
            }
            
            // Focus first input
            setTimeout(() => document.querySelector('input').focus(), 100);
        }

        function normalize(str) {
            return str ? str.trim().toLowerCase().replace(/\s+/g, '') : '';
        }

        function checkAnswers() {
            if (isReviewing) {
                nextQuestion();
                return;
            }

            const rows = document.getElementById('inputs-container').children;
            let allCorrect = true;
            
            // Logic: Since order doesn't matter (e.g., user can write Met then Cys, or Cys then Met),
            // We need to match each ROW to the BEST AVAILABLE correct item.
            
            let availableItems = [...currentCategory.items]; // Copy
            const userAnswers = [];

            // 1. Collect all user inputs
            for (let i = 0; i < rows.length; i++) {
                const inputs = rows[i].querySelectorAll('input');
                userAnswers.push({
                    rowElement: rows[i],
                    inputs: inputs,
                    ch: normalize(inputs[0].value),
                    en: normalize(inputs[1].value),
                    abbr: normalize(inputs[2].value)
                });
            }

            // 2. Validate
            // Simple heuristic: Try to match user's English or Abbr or Chinese to a correct item
            userAnswers.forEach(ans => {
                let matchIndex = -1;
                
                // Try to find a match in available items
                matchIndex = availableItems.findIndex(item => 
                    (ans.en && normalize(item.en) === ans.en) || 
                    (ans.abbr && normalize(item.abbr) === ans.abbr) ||
                    (ans.ch && normalize(item.ch) === ans.ch)
                );

                if (matchIndex !== -1) {
                    // We found a likely intended target. Now check STRICTLY all fields.
                    const target = availableItems[matchIndex];
                    let rowCorrect = true;

                    // Check Chinese
                    if (ans.ch !== normalize(target.ch)) {
                        ans.inputs[0].classList.add('incorrect');
                        rowCorrect = false;
                    } else {
                        ans.inputs[0].classList.add('correct');
                    }

                    // Check English
                    if (ans.en !== normalize(target.en)) {
                        ans.inputs[1].classList.add('incorrect');
                        rowCorrect = false;
                    } else {
                        ans.inputs[1].classList.add('correct');
                    }

                    // Check Abbr
                    if (ans.abbr !== normalize(target.abbr)) {
                        ans.inputs[2].classList.add('incorrect');
                        rowCorrect = false;
                    } else {
                        ans.inputs[2].classList.add('correct');
                    }

                    if (!rowCorrect) allCorrect = false;
                    
                    // Remove this item from available so we don't match it again
                    availableItems.splice(matchIndex, 1);

                } else {
                    // No match found at all (completely wrong or duplicate)
                    ans.inputs.forEach(input => input.classList.add('incorrect'));
                    allCorrect = false;
                }
            });

            // Show Correct Answers
            const feedbackList = document.getElementById('correct-answers-list');
            feedbackList.innerHTML = '';
            currentCategory.items.forEach(item => {
                const div = document.createElement('div');
                div.className = "flex justify-between items-center bg-white p-2 rounded border border-gray-200";
                div.innerHTML = `
                    <span class="font-bold text-gray-800">${item.ch}</span>
                    <span class="font-mono text-blue-600">${item.en}</span>
                    <span class="font-mono font-bold text-gray-500 bg-gray-100 px-2 rounded">${item.abbr}</span>
                `;
                feedbackList.appendChild(div);
            });
            document.getElementById('feedback-area').classList.remove('hidden');

            // Update Button
            const btn = document.getElementById('action-btn');
            if (allCorrect) {
                btn.innerText = "å¤ªç¥å•¦ï¼å…¨å°ï¼ä¸‹ä¸€é¡Œ ->";
                btn.className = "bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transform transition active:scale-95 text-lg";
                // Trigger confetti or shake
            } else {
                btn.innerText = "æ²’é—œä¿‚ï¼Œè¨‚æ­£å¾Œä¸‹ä¸€é¡Œ ->";
                btn.className = "bg-slate-600 hover:bg-slate-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transform transition active:scale-95 text-lg";
                document.getElementById('quiz-area').classList.add('anim-shake');
                setTimeout(()=>document.getElementById('quiz-area').classList.remove('anim-shake'), 500);
            }
            
            isReviewing = true;
        }

        // Init
        initGame();

    </script>
</body>
</html>
