<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…¨èƒ½åˆ·é¡Œç¥å™¨ v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* å‹•ç•«ç‰¹æ•ˆ */
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        .pop { animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { 0% { transform: scale(0.9); } 100% { transform: scale(1); } }

        /* é€²åº¦æ¢æ¨£å¼ */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen flex flex-col">

    <!-- App Container -->
    <div id="app" class="max-w-md mx-auto w-full min-h-screen bg-white shadow-2xl flex flex-col relative overflow-hidden">
        
        <!-- Header -->
        <header class="bg-slate-800 text-white p-4 flex justify-between items-center shadow-lg z-20">
            <div class="flex items-center gap-2">
                <i class="fas fa-brain text-yellow-400 text-xl"></i>
                <h1 class="font-black text-lg tracking-wider" id="app-title">å…¨èƒ½åˆ·é¡Œç‹</h1>
            </div>
            <div class="flex gap-3">
                <button onclick="resetProgress()" class="text-xs bg-slate-700 hover:bg-red-500 px-3 py-1.5 rounded-full transition border border-slate-600">
                    <i class="fas fa-trash-alt mr-1"></i>é‡ç½®
                </button>
                <button onclick="showStats()" class="text-xs bg-indigo-600 hover:bg-indigo-500 px-3 py-1.5 rounded-full transition shadow-lg shadow-indigo-500/30">
                    <i class="fas fa-chart-bar mr-1"></i>æ’è¡Œ
                </button>
            </div>
        </header>

        <!-- Dynamic Content -->
        <main id="content-area" class="flex-grow flex flex-col relative overflow-y-auto">
            <!-- é€™è£¡æœƒå‹•æ…‹æ’å…¥å…§å®¹ -->
        </main>

    </div>

    <script>
        // ==========================================
        // 1. é¡Œåº«è¨­å®š (æ›ç§‘ç›®æ”¹é€™è£¡ï¼)
        // ==========================================
        // æ ¼å¼ï¼š
        // id: å”¯ä¸€ç·¨è™Ÿ (å»ºè­°ç”¨ ç« ç¯€_é¡Œè™Ÿ)
        // chapter: ç« ç¯€åç¨± (é¡¯ç¤ºç”¨)
        // q: é¡Œç›®
        // options: [æ­£ç¢ºç­”æ¡ˆ, éŒ¯èª¤é¸é …1, éŒ¯èª¤é¸é …2, éŒ¯èª¤é¸é …3] 
        // ***æ³¨æ„ï¼šç¬¬ä¸€å€‹é¸é …å¿…é ˆæ”¾ã€Œæ­£ç¢ºç­”æ¡ˆã€ï¼Œç¨‹å¼æœƒè‡ªå‹•å¹«ä½ éš¨æ©Ÿæ‰“äº‚ä½ç½®ï¼***
        // rationale: è©³è§£

        const questionBank = [
            // --- Ch3 èƒºåŸºé…¸ (ä½œæ¥­ç¯„ä¾‹) ---
            {
                id: "ch3_1",
                chapter: "Ch3 èƒºåŸºé…¸",
                q: "ä¸‹åˆ—ä½•è€…ç‚ºä¸­æ€§èƒºåŸºé…¸ï¼Ÿ",
                options: ["ç”˜èƒºé…¸ (Glycine)", "é›¢èƒºé…¸ (Lysine)", "çµ„èƒºé…¸ (Histidine)", "éº©èƒºé…¸ (Glutamic acid)"],
                rationale: "Glycine æ˜¯éæ¥µæ€§ä¸­æ€§ï¼›Lys/His æ˜¯é¹¼æ€§ï¼›Glu æ˜¯é…¸æ€§ã€‚"
            },
            {
                id: "ch3_45",
                chapter: "Ch3 èƒºåŸºé…¸",
                q: "Sickle-cell anemia (é®åˆ€å‹è²§è¡€) æ˜¯è¡€ç´…ç´  Î² éˆç¬¬ 6 ä½çš„ Glutamate è¢«èª°å–ä»£ï¼Ÿ",
                options: ["Valine (çºˆèƒºé…¸)", "Glycine (ç”˜èƒºé…¸)", "Lysine (é›¢èƒºé…¸)", "Aspartate (å¤©é–€å†¬èƒºé…¸)"],
                rationale: "Sickle = S-V (Valine)ã€‚æ¥µæ€§è®Šç–æ°´æ€§ï¼Œå°è‡´èšåˆã€‚"
            },
            {
                id: "ch3_12",
                chapter: "Ch3 çµæ§‹",
                q: "æœ‰é—œè† åŸè›‹ç™½ (Collagen) çš„æ•˜è¿°ï¼Œä½•è€… **éŒ¯èª¤**ï¼Ÿ",
                options: ["å½¢æˆå·¦æ‰‹å‹çš„è¶…æ—‹é«”", "äººé«”å«é‡æœ€è±å¯Œçš„è›‹ç™½è³ª", "Gly èˆ‡ Pro å«é‡ç‰¹åˆ¥é«˜", "ä¸¦éå–®ä¸€è›‹ç™½è³ª"],
                rationale: "è† åŸè›‹ç™½æ˜¯ã€Œå³æ‰‹ã€è¶…èºæ—‹ (Right-handed Superhelix)ã€‚å–®è‚¡æ‰æ˜¯å·¦æ‰‹ã€‚"
            },
            {
                id: "ch3_41",
                chapter: "Ch3 çµæ§‹",
                q: "ä¸‹åˆ—å“ªä¸€ç¨®è©¦åŠ‘æœƒç ´å£è›‹ç™½è³ªå…§çš„ã€Œé›™ç¡«éµã€ï¼Ÿ",
                options: ["Î²-mercaptoethanol", "Urea (å°¿ç´ )", "SDS", "HCl"],
                rationale: "Î²-mercaptoethanol æ˜¯é‚„åŸåŠ‘ã€‚Urea ç ´å£æ°«éµï¼ŒSDS ç ´å£ç–æ°´ä½œç”¨ã€‚"
            },
            {
                id: "ch3_3",
                chapter: "Ch3 èƒºåŸºé…¸",
                q: "å…©å€‹ Methionine ä¹‹é–“ä¸èƒ½å½¢æˆé›™ç¡«éµï¼Œæ˜¯å› ç‚ºï¼Ÿ",
                options: ["å…¶ç¡«åŸå­å·²è¢«ç”²åŸºåŒ–", "ä¸å…·æœ‰ç¡«åŸå­", "è¼ƒ Cysteine å¤§", "ä½æ–¼ N-terminal"],
                rationale: "Met çš„ç¡«æ¥äº†ç”²åŸº (-S-CH3)ï¼Œæ˜¯ç¡«é†šåŸºï¼Œæ²’æœ‰è‡ªç”±çš„æ‰‹å»ç‰½åˆ¥äººã€‚"
            },
            
            // --- Ch4 é…µç´  (ä½œæ¥­ç¯„ä¾‹) ---
            {
                id: "ch4_1",
                chapter: "Ch4 é…µç´ ",
                q: "æ‰€è¬‚ Michaelis constant (Km) çš„æ„ç¾©ç‚ºä½•ï¼Ÿ",
                options: ["ä»£è¡¨åŸºè³ªå°é…µç´ çš„è¦ªå’Œç¨‹åº¦", "é…µç´ çš„åˆ†å­é‡", "æ¥µæ€§èƒºåŸºé…¸æ¯”ä¾‹", "é…µç´ è®Šæ€§ç¨‹åº¦"],
                rationale: "Km è¶Šå°ï¼Œè¦ªå’ŒåŠ› (Affinity) è¶Šå¤§ã€‚"
            },
            {
                id: "ch4_32",
                chapter: "Ch4 é…µç´ ",
                q: "é—œæ–¼é…µç´ çš„æ•˜è¿°ï¼Œä¸‹åˆ—ä½•è€… **éŒ¯èª¤**ï¼Ÿ",
                options: ["é…µç´ åƒ…ç”±è›‹ç™½è³ªçµ„æˆ", "æ˜¯ç”Ÿç‰©å‚¬åŒ–åŠ‘", "å¯å¢åŠ åæ‡‰é€Ÿç‡", "ä¸æ”¹è®Šåæ‡‰å¹³è¡¡"],
                rationale: "æœ‰äº›é…µç´ æ˜¯ RNA (Ribozyme)ï¼Œä¸å…¨æ˜¯è›‹ç™½è³ªã€‚"
            },

            // --- Ch7 è„‚è³ª (ä½œæ¥­ç¯„ä¾‹) ---
            {
                id: "ch7_8",
                chapter: "Ch7 è„‚è³ª",
                q: "ä¸‹åˆ—ä½•ç¨®è„‚è›‹ç™½ï¼Œå…¶ä¸‰é…¸ç”˜æ²¹é…¯ (TG) å«é‡æœ€é«˜ï¼Ÿ",
                options: ["Chylomicrons (ä¹³ç³œå¾®ç²’)", "VLDL", "LDL", "HDL"],
                rationale: "CM è² è²¬é‹é€å‰›åƒé€²ä¾†çš„æ²¹ï¼ŒTG å«é‡é«˜é” 85-90%ã€‚"
            },
            {
                id: "ch7_1",
                chapter: "Ch7 è„‚è³ª",
                q: "ä¸‹åˆ—ä½•è€… **ä¸å±¬æ–¼** å¿…éœ€è„‚è‚ªé…¸ï¼Ÿ",
                options: ["èŠ±ç”Ÿå››çƒ¯é…¸ (Arachidonate)", "äºéº»æ²¹é…¸ (Linoleate)", "Î±-æ¬¡äºéº»æ²¹é…¸", "ä»¥ä¸Šçš†æ˜¯"],
                rationale: "èŠ±ç”Ÿå››çƒ¯é…¸å¯ç”±äºéº»æ²¹é…¸è½‰è®Šè€Œä¾†ï¼Œåš´æ ¼ä¾†èªªä¸ç®—å¿…éœ€ (ä½†åœ¨æŸäº›æƒ…æ³ä¸‹æ˜¯æ¢ä»¶å¿…éœ€)ã€‚é¡Œç›®é€šå¸¸è€ƒæ²¹é…¸ (Oleic acid) éå¿…éœ€ã€‚"
            },
            {
                id: "ch7_19",
                chapter: "Ch7 è„‚è³ª",
                q: "Palmitic acid (16C) å®Œå…¨æ°§åŒ–å¾Œï¼Œæ·¨ç”Ÿæˆç´„å¤šå°‘ ATPï¼Ÿ",
                options: ["106 (æˆ– 129 èˆŠåˆ¶)", "36", "12", "54"],
                rationale: "16C -> 8 Acetyl-CoAã€‚ç¾ä»£ç”ŸåŒ–è¨ˆç®—æ³•ç´„ç‚º 106 ATPã€‚"
            }
        ];

        // ==========================================
        // 2. æ ¸å¿ƒé‚è¼¯ (Core Logic)
        // ==========================================
        
        const DB_KEY = 'quiz_master_v2_data';
        
        let state = {
            seenIds: [],      // å·²ç¶“åšé(ä¸è«–å°éŒ¯)çš„é¡Œç›®ID -> å¯¦ç¾ã€Œä¸é‡è¤‡ç›´åˆ°åˆ·å®Œã€
            wrongCounts: {},  // { 'id': 5 } -> éŒ¯é¡Œæ’è¡Œ
            currentBatch: [], // ç›®å‰é€™ä¸€å›åˆçš„ 10 é¡Œ
            batchIndex: 0,    // ç›®å‰åœ¨ç¬¬å¹¾é¡Œ
            score: 0
        };

        function loadState() {
            const saved = localStorage.getItem(DB_KEY);
            if (saved) state = { ...state, ...JSON.parse(saved) };
        }

        function saveState() {
            localStorage.setItem(DB_KEY, JSON.stringify(state));
        }

        // æ´—ç‰Œæ¼”ç®—æ³• (Fisher-Yates)
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        // æº–å‚™æ–°å›åˆ
        function prepareRound() {
            // æ‰¾å‡ºé‚„æ²’åšéçš„é¡Œç›®
            const availableQs = questionBank.filter(q => !state.seenIds.includes(q.id));
            
            if (availableQs.length === 0) {
                // é¡Œåº«åˆ·å®Œäº†ï¼
                renderAllClear();
                return;
            }

            // éš¨æ©Ÿå– 10 é¡Œ (æˆ–å‰©ä¸‹æ‰€æœ‰é¡Œç›®)
            const count = Math.min(10, availableQs.length);
            const shuffledPool = shuffle([...availableQs]); // è¤‡è£½ä¸¦æ´—ç‰Œ
            
            state.currentBatch = shuffledPool.slice(0, count).map(q => {
                // *** é—œéµï¼šé€™è£¡åšé¸é …å½éš¨æ©Ÿ ***
                // åŸå§‹è³‡æ–™ options[0] æ°¸é æ˜¯æ­£ç¢ºç­”æ¡ˆ
                // æˆ‘å€‘ç”¢ç”Ÿä¸€å€‹ç‰©ä»¶é™£åˆ—ï¼Œè¨˜ä½èª°æ˜¯å°çš„
                let randomizedOpts = q.options.map((text, idx) => ({ text, isCorrect: idx === 0 }));
                return {
                    ...q,
                    randomOptions: shuffle(randomizedOpts) // æ‰“äº‚é¸é …é †åº
                };
            });
            
            state.batchIndex = 0;
            state.score = 0;
            renderQuestion();
        }

        // ==========================================
        // 3. UI æ¸²æŸ“ (Rendering)
        // ==========================================

        const content = document.getElementById('content-area');

        function init() {
            loadState();
            // å¦‚æœä¸åœ¨å›åˆä¸­ï¼Œé¡¯ç¤ºé¦–é 
            if (!state.currentBatch || state.currentBatch.length === 0 || state.batchIndex >= state.currentBatch.length) {
                renderHome();
            } else {
                renderQuestion(); // æ¢å¾©ä¸Šæ¬¡é€²åº¦
            }
        }

        // é¦–é 
        function renderHome() {
            const total = questionBank.length;
            const done = state.seenIds.length;
            const remaining = total - done;
            const progressPercent = Math.round((done / total) * 100);

            content.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full p-6 space-y-8 fade-in">
                    
                    <!-- é€²åº¦ç’° -->
                    <div class="relative w-48 h-48 flex items-center justify-center">
                        <svg class="w-full h-full" viewBox="0 0 100 100">
                            <circle class="text-slate-100 stroke-current" stroke-width="8" cx="50" cy="50" r="40" fill="transparent"></circle>
                            <circle class="text-indigo-500 progress-ring__circle stroke-current" stroke-width="8" stroke-linecap="round" cx="50" cy="50" r="40" fill="transparent" stroke-dasharray="251.2" stroke-dashoffset="${251.2 - (251.2 * progressPercent) / 100}"></circle>
                        </svg>
                        <div class="absolute text-center">
                            <span class="text-4xl font-black text-slate-700">${remaining}</span>
                            <div class="text-xs text-slate-400 uppercase font-bold tracking-wider">é¡Œå‰©é¤˜</div>
                        </div>
                    </div>

                    <div class="text-center">
                        <h2 class="text-2xl font-bold text-slate-800 mb-2">æº–å‚™å¥½æŒ‘æˆ°äº†å—ï¼Ÿ</h2>
                        <p class="text-slate-500 text-sm">æ¯å›åˆ 10 é¡Œï¼Œé¸é …è‡ªå‹•æ´—ç‰Œã€‚<br>ç›´åˆ°é¡Œåº«æ­¸é›¶å‰ï¼Œé¡Œç›®ä¸æœƒé‡è¤‡ï¼</p>
                    </div>

                    <button onclick="prepareRound()" class="w-full max-w-xs bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-2xl shadow-xl shadow-indigo-500/30 transform transition active:scale-95 text-lg flex items-center justify-center gap-2">
                        <i class="fas fa-play"></i> é–‹å§‹ä¸€å›åˆ
                    </button>
                    
                    ${remaining === 0 ? '<button onclick="resetProgress()" class="text-sm text-slate-400 underline">é¡Œåº«å·²ç©ºï¼Œé»æ­¤é‡ç½®</button>' : ''}
                </div>
            `;
        }

        // é¡Œç›®é é¢
        function renderQuestion() {
            const q = state.currentBatch[state.batchIndex];
            const currentQNum = state.batchIndex + 1;
            const totalBatch = state.currentBatch.length;

            content.innerHTML = `
                <div class="p-6 min-h-full flex flex-col fade-in">
                    <!-- Progress Bar -->
                    <div class="w-full bg-slate-100 h-2 rounded-full mb-6 overflow-hidden">
                        <div class="bg-indigo-500 h-full transition-all duration-300" style="width: ${(currentQNum / totalBatch) * 100}%"></div>
                    </div>

                    <!-- Question Card -->
                    <div class="bg-white border-2 border-slate-100 p-5 rounded-2xl shadow-sm mb-6">
                        <div class="flex justify-between items-center mb-3">
                            <span class="bg-indigo-50 text-indigo-600 text-xs font-bold px-2 py-1 rounded-md uppercase tracking-wider">${q.chapter}</span>
                            <span class="text-slate-300 text-xs font-bold">Q${currentQNum}/${totalBatch}</span>
                        </div>
                        <h3 class="text-xl font-bold text-slate-800 leading-relaxed">${q.q}</h3>
                    </div>

                    <!-- Options Grid -->
                    <div class="grid gap-3 flex-grow content-start" id="options-container">
                        ${q.randomOptions.map((opt, idx) => `
                            <button onclick="handleAnswer(${idx})" class="option-btn w-full text-left p-4 rounded-xl border-2 border-slate-100 hover:border-indigo-500 hover:bg-indigo-50 transition active:scale-95 flex items-start gap-3 group">
                                <div class="mt-0.5 w-6 h-6 rounded-full border-2 border-slate-200 text-slate-300 flex items-center justify-center text-xs font-bold group-hover:border-indigo-500 group-hover:text-indigo-500 transition">
                                    ${String.fromCharCode(65 + idx)}
                                </div>
                                <span class="font-medium text-slate-600 group-hover:text-indigo-700">${opt.text}</span>
                            </button>
                        `).join('')}
                    </div>

                    <!-- Feedback (Hidden) -->
                    <div id="feedback-panel" class="hidden mt-4 bg-slate-50 border border-slate-200 p-4 rounded-xl pop">
                        <div id="feedback-header" class="font-bold text-lg mb-1"></div>
                        <div id="feedback-body" class="text-sm text-slate-600 mb-4 leading-relaxed"></div>
                        <button onclick="nextQuestion()" class="w-full bg-slate-800 text-white font-bold py-3 rounded-xl hover:bg-slate-700 transition">ä¸‹ä¸€é¡Œ <i class="fas fa-arrow-right ml-1"></i></button>
                    </div>
                </div>
            `;
        }

        function handleAnswer(selectedIndex) {
            const q = state.currentBatch[state.batchIndex];
            const selectedOpt = q.randomOptions[selectedIndex];
            const isCorrect = selectedOpt.isCorrect;
            
            // è¨˜éŒ„é€™é¡Œå·²ç¶“çœ‹éäº† (ç„¡è«–å°éŒ¯éƒ½ç®—çœ‹éï¼Œé€™æ¨£æ‰æœƒæ¶ˆè€—é¡Œåº«)
            // å¦‚æœä½ æƒ³æ”¹æˆã€Œç­”å°æ‰ç®—éã€ï¼Œå°±æŠŠé€™è¡Œç§»åˆ° isCorrect è£¡é¢
            if (!state.seenIds.includes(q.id)) {
                state.seenIds.push(q.id);
            }

            // UI Feedback
            const btns = document.querySelectorAll('.option-btn');
            btns.forEach(btn => {
                btn.disabled = true; // é–å®š
                btn.classList.add('opacity-50');
            });
            
            const selectedBtn = btns[selectedIndex];
            selectedBtn.classList.remove('opacity-50', 'hover:border-indigo-500', 'hover:bg-indigo-50');

            const feedbackHeader = document.getElementById('feedback-header');
            const feedbackBody = document.getElementById('feedback-body');
            const feedbackPanel = document.getElementById('feedback-panel');

            if (isCorrect) {
                state.score++;
                selectedBtn.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                selectedBtn.querySelector('div').classList.add('border-green-500', 'text-green-500');
                feedbackHeader.innerHTML = `<span class="text-green-600"><i class="fas fa-check-circle"></i> ç­”å°äº†ï¼</span>`;
            } else {
                selectedBtn.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
                selectedBtn.querySelector('div').classList.add('border-red-500', 'text-red-500');
                feedbackHeader.innerHTML = `<span class="text-red-600"><i class="fas fa-times-circle"></i> å“å‘€éŒ¯äº†...</span>`;
                
                // æ¨™ç¤ºæ­£ç¢ºç­”æ¡ˆ
                const correctIdx = q.randomOptions.findIndex(o => o.isCorrect);
                btns[correctIdx].classList.remove('opacity-50', 'border-slate-100');
                btns[correctIdx].classList.add('bg-green-50', 'border-green-500', 'ring-2', 'ring-green-200');

                // è¨˜éŒ„éŒ¯é¡Œ
                state.wrongCounts[q.id] = (state.wrongCounts[q.id] || 0) + 1;
            }

            feedbackBody.innerText = q.rationale || "æ­¤é¡Œç„¡è©³è§£ï¼Œè«‹æ­»è¨˜ï¼";
            feedbackPanel.classList.remove('hidden');
            
            // Scroll to bottom
            setTimeout(() => {
                feedbackPanel.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }, 100);

            saveState();
        }

        function nextQuestion() {
            state.batchIndex++;
            if (state.batchIndex < state.currentBatch.length) {
                renderQuestion();
            } else {
                renderRoundResult();
            }
            saveState();
        }

        // å›åˆçµç®—
        function renderRoundResult() {
            // æ¸…ç©º currentBatch è¡¨ç¤ºå›åˆçµæŸ
            state.currentBatch = [];
            state.batchIndex = 0;
            saveState();

            const remaining = questionBank.length - state.seenIds.length;

            content.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full p-6 text-center fade-in">
                    <div class="text-6xl mb-4">ğŸ‰</div>
                    <h2 class="text-3xl font-black text-slate-800 mb-2">å›åˆå®Œæˆ</h2>
                    <p class="text-slate-500 mb-8">ä¼‘æ¯ä¸€ä¸‹ï¼Œå¤§è…¦æ­£åœ¨å­˜æª”...</p>

                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 w-full mb-8">
                        <div class="text-xs text-slate-400 uppercase font-bold mb-1">æœ¬æ¬¡ç­”å°</div>
                        <div class="text-5xl font-black text-indigo-600 mb-4">${state.score} <span class="text-lg text-slate-300">/ 10</span></div>
                        <div class="text-xs text-slate-400 border-t border-slate-100 pt-3">
                            é¡Œåº«é‚„å‰© <strong class="text-slate-800">${remaining}</strong> é¡Œæ²’åˆ·
                        </div>
                    </div>

                    <button onclick="prepareRound()" class="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 transition mb-3">
                        ç¹¼çºŒä¸‹ä¸€å›åˆ
                    </button>
                    <button onclick="renderHome()" class="w-full bg-white text-slate-600 font-bold py-4 rounded-xl border border-slate-200 hover:bg-slate-50 transition">
                        å›é¦–é 
                    </button>
                </div>
            `;
        }

        // é¡Œåº«å…¨åˆ·å®Œ
        function renderAllClear() {
            content.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full p-6 text-center fade-in">
                    <div class="text-6xl mb-4">ğŸ†</div>
                    <h2 class="text-3xl font-black text-slate-800 mb-2">å¤ªå¼·å•¦ï¼</h2>
                    <p class="text-slate-500 mb-8">é¡Œåº«è£¡çš„æ‰€æœ‰é¡Œç›®ä½ éƒ½åšéä¸€éäº†ï¼</p>

                    <div class="bg-yellow-50 p-6 rounded-2xl border border-yellow-200 w-full mb-8 text-yellow-800">
                        <i class="fas fa-crown text-3xl mb-2 text-yellow-500"></i>
                        <h3 class="font-bold">åˆ¶éœ¸é”æˆ</h3>
                        <p class="text-sm opacity-80 mt-1">ç¾åœ¨å¯ä»¥å»æŒ‘æˆ°éŒ¯é¡Œæ’è¡Œæ¦œï¼Œæˆ–æ˜¯é‡ç½®é€²åº¦å†ä¾†ä¸€è¼ªï¼</p>
                    </div>

                    <button onclick="resetProgress()" class="w-full bg-red-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-red-500/30 hover:bg-red-600 transition mb-3">
                        é‡ç½®æ‰€æœ‰é€²åº¦ (é‡é ­ä¾†é)
                    </button>
                    <button onclick="renderHome()" class="w-full bg-white text-slate-600 font-bold py-4 rounded-xl border border-slate-200 hover:bg-slate-50 transition">
                        å›é¦–é 
                    </button>
                </div>
            `;
        }

        // éŒ¯é¡Œæ’è¡Œæ¦œ
        function showStats() {
            // è¨ˆç®—æ•¸æ“š
            const wrongList = Object.entries(state.wrongCounts)
                .map(([id, count]) => {
                    const q = questionBank.find(x => x.id === id);
                    return { id, count, q };
                })
                .filter(x => x.q) // éæ¿¾æ‰å¯èƒ½å·²è¢«åˆªé™¤çš„é¡Œç›®
                .sort((a, b) => b.count - a.count);

            const html = wrongList.length === 0 
                ? `<div class="text-center text-slate-400 py-20">ç›®å‰æ²’æœ‰éŒ¯é¡Œç´€éŒ„<br>ä½ æ˜¯å­¸éœ¸å—ï¼Ÿ</div>`
                : wrongList.map((item, idx) => `
                    <div class="bg-white p-4 rounded-xl border border-slate-100 flex gap-4 items-start shadow-sm">
                        <div class="flex-shrink-0 w-8 h-8 ${idx < 3 ? 'bg-red-100 text-red-600' : 'bg-slate-100 text-slate-500'} rounded-lg flex items-center justify-center font-black">
                            ${idx + 1}
                        </div>
                        <div class="flex-grow">
                            <div class="flex justify-between items-start mb-1">
                                <span class="text-[10px] font-bold bg-slate-100 text-slate-500 px-1.5 py-0.5 rounded uppercase">${item.q.chapter}</span>
                                <span class="text-xs font-bold text-red-500 flex items-center gap-1"><i class="fas fa-times"></i> ${item.count}</span>
                            </div>
                            <p class="text-sm font-bold text-slate-700 line-clamp-2">${item.q.q}</p>
                        </div>
                    </div>
                `).join('');

            content.innerHTML = `
                <div class="p-4 fade-in min-h-full flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-black text-slate-800">â˜ ï¸ éŒ¯é¡Œæ’è¡Œæ¦œ</h2>
                        <button onclick="init()" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 hover:bg-slate-200"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="flex-grow space-y-3 overflow-y-auto pb-20">
                        ${html}
                    </div>
                </div>
            `;
        }

        function resetProgress() {
            if(!confirm("ç¢ºå®šè¦é‡ç½®æ‰€æœ‰é€²åº¦å—ï¼ŸéŒ¯é¡Œç´€éŒ„ä¹Ÿæœƒæ¶ˆå¤±å–”ï¼")) return;
            state = { seenIds: [], wrongCounts: {}, currentBatch: [], batchIndex: 0, score: 0 };
            saveState();
            renderHome();
        }

        // Start
        init();

    </script>
</body>
</html>
```

### ğŸ“Œ çµ¦ä½ çš„ GitHub æ”¹ç‰ˆæŒ‡å—

æ—¢ç„¶ä½ ä¸æœƒå¯«ç¨‹å¼ï¼Œé€™è£¡æœ‰æœ€ç°¡å–®çš„**ã€Œæ›¿æ›é¡Œåº«ã€**æ•™å­¸ï¼š

1.  **æ‰“é–‹æª”æ¡ˆ**ï¼šç”¨è¨˜äº‹æœ¬ (Notepad) æˆ– VS Code æ‰“é–‹é€™å€‹ `index.html`ã€‚
2.  **æœå°‹é—œéµå­—**ï¼šæŒ‰ä¸‹ `Ctrl + F` æœå°‹ `const questionBank = [`ã€‚
3.  **æ›¿æ›å…§å®¹**ï¼š
    ä½ æœƒçœ‹åˆ°å¾ˆå¤šåƒé€™æ¨£çš„å¤§æ‹¬è™Ÿ `{ ... }`ã€‚æ¯ä¸€å€‹å¤§æ‹¬è™Ÿå°±æ˜¯ä¸€é¡Œã€‚
    * `id`: çµ¦å®ƒä¸€å€‹ç·¨è™Ÿ (ä¸è¦é‡è¤‡)ã€‚
    * `chapter`: æ”¹æˆ "æ­·å² ç¬¬ä¸€ç« " æˆ– "è‹±æ–‡ å–®å­—"ã€‚
    * `q`: æ”¹æˆä½ çš„æ–°é¡Œç›®ã€‚
    * `options`: **é‡é»ï¼** ç¬¬ä¸€å€‹ä½ç½® (index 0) **ä¸€å®šè¦æ”¾æ­£ç¢ºç­”æ¡ˆ**ã€‚ç¨‹å¼æœƒè‡ªå‹•å¹«ä½ æŠŠé€™å€‹æ­£ç¢ºç­”æ¡ˆéš¨æ©Ÿæ´—åˆ° A, B, C æˆ– D å»ã€‚æ‰€ä»¥ä½ åœ¨è¼¸å…¥æ™‚ï¼Œä¸ç”¨è‡ªå·±æƒ³é€™é¡Œè¦æ”¾ B é‚„æ˜¯ Cï¼Œ**å…¨éƒ¨æ”¾ç¬¬ä¸€å€‹å°±å°äº†**ã€‚
    * `rationale`: è©³è§£ã€‚

**ä¾‹å¦‚ï¼Œä½ è¦æ”¹æˆæ­·å²è€ƒé¡Œï¼š**
```javascript
{
    id: "hist_1",
    chapter: "å°ç£å²",
    q: "é„­æˆåŠŸåœ¨å“ªä¸€å¹´æ”»å°ï¼Ÿ",
    options: ["1661å¹´", "1662å¹´", "1683å¹´", "1624å¹´"], // ç¬¬ä¸€å€‹æ˜¯æ­£è§£
    rationale: "1661å¹´é„­æˆåŠŸç‡è»ç™»é™¸é¹¿è€³é–€ã€‚"
},
